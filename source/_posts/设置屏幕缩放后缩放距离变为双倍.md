---
title: 设置屏幕缩放后缩放距离变为双倍
date: 2021-05-07 10:47:19
tags: Android
cover: false
categories: 
- Android
- BUG总结

---

## 复现步骤（问题）

1. 在Android6.0系统中设置屏幕缩放，向内缩小屏幕任意范围
2. 在一定的条件下，如关闭一个dialog风格的activity、关闭popupwindow
3. 会发现向内缩小的屏幕尺寸变大一倍

## 解决

通过Android Studio中的layout inspector分析发现：屏幕缩放的实现方式是在`DecorView`中设置padding进行屏幕变化，但出现问题后，一个id为`action_bar_root`的`FitWindowsLinearLayout`中也出现了**相同数值**的padding。找到相应的`abc_screen_simple.xml`后发现这个View上配置了`android:fitsSystemWindows="true"`

<!-- more -->

> 大部分的时候，你的应用都不会在状态栏和导航栏下面显示内容，如果你需要在他们下面显示内容，则需要确保你应用的可交互控件（比如按钮）不要显示在系统窗口下面了。 android:fitsSystemWindows=“true” 默认行为就是通过在 View 上设置和系统窗口一样高度的边框（padding ）来确保你的内容不会出现到系统窗口下面。
>
> https://blog.chengyunfeng.com/?p=905

所以将这个`fitsSystemWindows`值改为false即可。

```java
override fun onResume() {
        super.onResume()

        handler.post {
            // 更改为false
            window.decorView.findViewById<View>(R.id.action_bar_root).fitsSystemWindows = false
        }
    }
```

